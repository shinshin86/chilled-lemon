<p align="center">
    <img src="./logo/project-logo.png" alt="project logo" />
</p>
<h1 align="center">chilled-lemon</h1>

[![Test](https://github.com/shinshin86/chilled-lemon/actions/workflows/test.yml/badge.svg)](https://github.com/shinshin86/chilled-lemon/actions/workflows/test.yml)

This library provides functionality to extract information stored within PNG images generated by Stable Diffusion Web UI.

It also provides functions to mutually convert between infotext and JSON formats.

## Usageï¼ˆextract infotext in PNG images)

You can use `getInfotext` or `getInfotextJson` to extract infotext embedded in PNG images.

Support `CJS/ESM/UMD`

### CommonJS

```javascript
const { getInfotext, getInfotextJson } = require('chilled-lemon');
const { readFile } = require('node:fs/promises');

(async () => {
    const buf = await readFile('./test.png');

    const infotext = await getInfotext(buf);
    console.log(infotext);

    const json = await getInfotextJson(buf);
    console.log(json);
})();
```

### ES Modules

```javascript
import { getInfotext, getInfotextJson } from 'chilled-lemon';
import { readFile } from 'node:fs/promises';

const buf = await readFile('./test.png');

const infotext = await getInfotext(buf);
console.log(infotext);

const json = await getInfotextJson(buf);
console.log(json);
```


### UMD

```html
<!DOCTYPE html>
<html>

<head>
    <script src="/node_modules/chilled-lemon/dist/index.umd.js"></script>
</head>

<body>
    <input type="file" id="inputFile" />
    <button onclick="getPngInfoFromFile()">Get PNG Info</button>
    <pre id="output"></pre>

    <script>
        const { getInfotext, getInfotextJson } = window.ChilledLemon;

        async function getPngInfoFromFile() {
            const fileInput = document.getElementById('inputFile');
            const file = fileInput.files[0];
            const arrayBuffer = await file.arrayBuffer();

            try {
                const outputElement = document.getElementById('output');

                const infotext = await getInfotext(arrayBuffer);
                outputElement.textContent += '\n\n===PNG INFO (infotext format)===\n' + infotext;

                const json = await getInfotextJson(arrayBuffer);
                outputElement.textContent += '\n\n===PNG INFO (JSON format)===\n' + JSON.stringify(json);
            } catch (err) {
                console.error(`Error reading file: ${err.message}`);
            }
        }
    </script>
</body>

</html>
```


## Usage (Conversion between infotext and JSON)

You can use `convertInfotextToJson` and `convertJsonToInfotext` to convert between infotext and JSON.

```javascript
import { getInfotext, getInfotextJson, convertInfotextToJson, convertJsonToInfotext } from 'chilled-lemon';
import { readFile } from 'node:fs/promises';

const buf = await readFile('./test.png');

const infotext = await getInfotext(buf);
const convertedJson = await convertInfotextToJson(infotext);
console.log(convertedJson)

const json = await getInfotextJson(buf);
const convertedInfotext = await convertJsonToInfotext(json);
console.log(convertedInfotext);
```

## inspired

The idea for this source code was inspired by [this blog post (Japanese post)](https://qiita.com/javacommons/items/472e85be1b11098172b3).

## License

MIT