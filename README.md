# chilled-lemon
![project logo](./logo/project-logo.png)

This library provides functionality to extract information stored within PNG images generated by Stable Diffusion Web UI.

## Usage

Support `CJS/ESM/UMD`

### CommonJS

```javascript
const { getPngInfo } = require('chilled-lemon');
const { readFile } = require('node:fs/promises');

(async () => {
    const buf = await readFile('./test.png');
    const jsonOutput = await getPngInfo(buf);
    console.log(jsonOutput);
    const textOutput = await getPngInfo(buf, { format: 'text' });
    console.log(textOutput);
})();
```

### ES Modules

```javascript
import { getPngInfo } from 'chilled-lemon';
import { readFile } from 'node:fs/promises';

const buf = await readFile('./test.png');
const jsonOutput = await getPngInfo(buf);
console.log(jsonOutput);
const textOutput = await getPngInfo(buf, { format: 'text' });
console.log(textOutput);
```


### UMD

```html
<!DOCTYPE html>
<html>

<head>
    <script src="/node_modules/chilled-lemon/dist/index.umd.js"></script>
</head>

<body>
    <input type="file" id="inputFile" />
    <button onclick="getPngInfoFromFile()">Get PNG Info</button>
    <pre id="output"></pre>

    <script>
        const { getPngInfo } = window.ChilledLemon;

        async function getPngInfoFromFile() {
            const fileInput = document.getElementById('inputFile');
            const file = fileInput.files[0];
            const arrayBuffer = await file.arrayBuffer();

            try {
                const outputElement = document.getElementById('output');

                const pngInfoObj = await getPngInfo(arrayBuffer);
                outputElement.textContent = '===PNG INFO (JSON)===\n' + JSON.stringify(pngInfoObj);

                const textOutput = await getPngInfo(arrayBuffer, { format: 'text' });
                outputElement.textContent += '\n\n===PNG INFO===\n' + textOutput;
            } catch (err) {
                console.error(`Error reading file: ${err.message}`);
            }
        }
    </script>
</body>

</html>
```

## Methods and Types

```typescript
import { getPngInfo, getOriginalKeyNames, PngInfoObject, OriginalKeyPngInfoObject, LoraHash } from 'chilled-lemon';
```

### Methods

### getPngInfo(arrayBuffer: ArrayBuffer, options?: Options): Promise<PngInfoObject | string>

Extracts the information from a PNG image represented by an ArrayBuffer. The options argument allows you to specify the format in which the extracted data should be returned: 'json' (default) or 'text'.

#### Parameters
* `arrayBuffer` An ArrayBuffer representation of the PNG image to extract information from.
* `options` (Optional) An object specifying options for the function. Available options are:
  * `format` The format in which the function should return the extracted information. This can either be 'json' or 'text'. If not specified, 'json' is used by default.

#### Returns
A promise which resolves to either an object representing the information extracted from the PNG image (PngInfoObject) if the format option is set to 'json', or a string if the format option is set to 'text'.

### getOriginalKeyNames(obj: PngInfoObject): OriginalKeyPngInfoObject

Converts the keys of a PngInfoObject from the library's internal naming scheme back to their original names.

#### Parameters
* `obj` A PngInfoObject whose keys should be converted.

#### Returns
An OriginalKeyPngInfoObject whose keys have been converted back to their original names.

### Types

### PngInfoObject

An object representing the information extracted from a PNG image. The keys of this object correspond to the different pieces of information that can be stored in a PNG image by Stable Diffusion Web UI.

### OriginalKeyPngInfoObject

A version of PngInfoObject where the keys have been converted back to their original names.


### LoraHash
An object representing a set of Lora hashes. This object's keys are the names of the Lora hashes, and its values are the corresponding hash values.


## inspired

The idea for this source code was inspired by [this blog post (Japanese post)](https://qiita.com/javacommons/items/472e85be1b11098172b3).

## License

MIT